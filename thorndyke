#!/usr/bin/env python3

import os
import sys
import json
import signal
import threading
import subprocess
from tqdm import tqdm
from datetime import datetime
sys.path.append(os.getcwd()+"/.lib/")
sys.path.append(os.getcwd()+"/.src/")
from _main_ import *
from colors import red,green,yellow,white,reset
    
if __name__ == "__main__":
    threads = []
    start = datetime.now()
    print(f"{white}Starting Thorndyke 2021.1.0.0-beta - (https://git.io/JKPxl) at {green}{start.strftime('%a %b %y, %H:%M:%S%p')}{reset}")
    print(f"{white}={reset}"*100)
    if args.shell:
    	subprocess.run(["chmod","+x",f"{os.getcwd()}/.src/thorndyke.sh"],text=True)
    	print(f"üîé {white}[thorndyke.{green}sh{white}] Enumerating @{green}{args.username}{white}:{reset}")
    	subprocess.run([f"{os.getcwd()}/.src/thorndyke.sh", f"{args.username}"],text=True)
    else:
    	if args.dictionary:
    		site_list = args.dictionary
    	else:
    		site_list = ".rsc/sites.json"
    		with open(site_list) as data_file:
    		    data = json.load(data_file)
    		    
    		for site in tqdm(data['sites']):
    		    x = threading.Thread(target=thorndyke, args=(site, args.username), daemon=True)
    		    threads.append(x)
    		    
    		for thread in threads:
    		    thread.start()
    		    
    		for thread in threads:
    			thread.join()
    		print(f"{white}={reset}"*100)
    		if args.username:
    			print(f"‚úîÔ∏è  {white}@{green}{args.username}{white} Found on {green}{len(username_results)}{white} site(s):\n")
    			for result in tqdm(username_results):
    			    print(result)
    			    
    		if args.output:
    			with open(args.output, "a") as file:
    				for item in found_sites:
    					file.write(item + "\n")
    				file.close()
    				print(f"\n‚úçÔ∏è  {white}Output written to ./{green}{args.output}{reset}")
    			
    		print(f"‚õî {white}Stopped in {green}{datetime.now()-start}{white} seconds.{reset}")
